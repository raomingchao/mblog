<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>


    <meta name="description" content="Misael's Blog" />



  <meta name="keywords" content="php," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    analytics: {
      google: ''
    },
    sidebar: 'post'
  };
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?153ab4cca012c65c1e8181938cf81db7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <title> PHP技巧汇总 // M </title>
</head>

<body>
  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->

  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">M</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<div class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/">
            <i class="menu-item-icon icon-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            <i class="menu-item-icon icon-categories"></i> <br />
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            <i class="menu-item-icon icon-tags"></i> <br />
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            <i class="menu-item-icon icon-archives"></i> <br />
            归档
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
<form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', '4i1GtPgrpPo8ddmCMWmC','2.0.0');
</script>

<div class="site-search-toggle"></div>
    </div>
  
</div>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              PHP技巧汇总
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015-07-10
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/php/">php</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/10/PHP技巧汇总/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/07/10/PHP技巧汇总/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        <h3 id="自动加载类">自动加载类</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先，定义你的自动载入的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">autoload</span><span class="params">(<span class="variable">$className</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">include_once</span>(<span class="variable">$className</span> . <span class="string">'.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后，注册它。</span></span><br><span class="line">spl_autoload_register(<span class="string">'autoload'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后，使用它</span></span><br><span class="line"><span class="comment">// 因为我们没包含一个定义有 DemoClass 的文件，所以自动加载器会介入并包含 DemoClass.php。</span></span><br><span class="line"><span class="comment">// 在本例中，假定在 DemoClass.php 文件中定义了 DemoClass 类。</span></span><br><span class="line"><span class="variable">$var</span> = <span class="keyword">new</span> DemoClass();</span><br></pre></td></tr></table></figure>
<h3 id="验证邮件地址">验证邮件地址</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">filter_var(<span class="string">'sgamgee@example.com'</span>, FILTER_VALIDATE_EMAIL);</span><br><span class="line"><span class="comment">//Returns "sgamgee@example.com". This is a valid email address.</span></span><br><span class="line">filter_var(<span class="string">'sauron@mordor'</span>, FILTER_VALIDATE_EMAIL);</span><br><span class="line"><span class="comment">// Returns boolean false! This is *not* a valid email address.</span></span><br></pre></td></tr></table></figure>
<h3 id="净化_HTML_输入和输出">净化 HTML 输入和输出</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Oh no!  The user has submitted malicious HTML, and we have to display it in our web app!</span></span><br><span class="line"><span class="variable">$evilHtml</span> = <span class="string">'&lt;div onclick="xss();"&gt;Mua-ha-ha!  Twiddling my evil mustache...&lt;/div&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use the ENT_QUOTES flag to make sure both single and double quotes are escaped.</span></span><br><span class="line"><span class="comment">// Use the UTF-8 character encoding if you've stored the text as UTF-8 (as you should have).</span></span><br><span class="line"><span class="comment">// See the UTF-8 section in this document for more details.</span></span><br><span class="line"><span class="variable">$safeHtml</span> = htmlentities(<span class="variable">$evilHtml</span>, ENT_QUOTES, <span class="string">'UTF-8'</span>);</span><br><span class="line"><span class="comment">// $safeHtml is now fully escaped HTML.  You can output $safeHtml to your users without fear!</span></span><br></pre></td></tr></table></figure>
<h3 id="检测一个值是否为_null_或_false">检测一个值是否为 null 或 false</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$x</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$y</span> = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is $x null?</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$x</span> == <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Oops! $x is 0, not null!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is $y null?</span></span><br><span class="line"><span class="keyword">if</span>(is_null(<span class="variable">$y</span>))</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Great, but could be faster.'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$y</span> === <span class="keyword">null</span>)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Perfect!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Does the string abc contain the character a?</span></span><br><span class="line"><span class="keyword">if</span>(strpos(<span class="string">'abc'</span>, <span class="string">'a'</span>))</span><br><span class="line">    <span class="comment">// GOTCHA!  strpos returns 0, indicating it wishes to return the position of the first character.</span></span><br><span class="line">    <span class="comment">// But PHP interpretes 0 as false, so we never reach this print statement!</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Found it!'</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">//Solution: use !== (the opposite of ===) to see if strpos() returns 0, or boolean false.   </span></span><br><span class="line"><span class="keyword">if</span>(strpos(<span class="string">'abc'</span>, <span class="string">'a'</span>) !== <span class="keyword">false</span>)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Found it for real this time!'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="生成唯一订单号">生成唯一订单号</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *</span><br><span class="line"> * uniqid - 官方是这样说的：</span><br><span class="line"> * Gets a prefixed unique identifier based on the current time in microseconds.</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">build_order_no</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> date(<span class="string">'Ymd'</span>).substr(implode(<span class="keyword">NULL</span>, array_map(<span class="string">'ord'</span>, str_split(substr(uniqid(), <span class="number">7</span>, <span class="number">13</span>), <span class="number">1</span>))), <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5行vs9行_不用递归实现无限分类数据的树形格式化">5行vs9行 不用递归实现无限分类数据的树形格式化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 方法一：</span><br><span class="line"> * 此方法由<span class="doctag">@Tonton</span> 提供</span><br><span class="line"> * <span class="doctag">@form</span> http://levi.cg.am</span><br><span class="line"> * <span class="doctag">@date</span> 2012-12-12</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genTree5</span><span class="params">(Array <span class="variable">$items</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$items</span> <span class="keyword">as</span> <span class="variable">$item</span>)</span><br><span class="line">        <span class="variable">$items</span>[<span class="variable">$item</span>[<span class="string">'pid'</span>]][<span class="string">'son'</span>][<span class="variable">$item</span>[<span class="string">'id'</span>]] = &amp;<span class="variable">$items</span>[<span class="variable">$item</span>[<span class="string">'id'</span>]];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="variable">$items</span>[<span class="number">0</span>][<span class="string">'son'</span>]) ? <span class="variable">$items</span>[<span class="number">0</span>][<span class="string">'son'</span>] : <span class="keyword">array</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 方法二：将数据格式化成树形结构</span><br><span class="line"> * <span class="doctag">@author</span> Xuefen.Tong</span><br><span class="line"> * <span class="doctag">@form</span> http://levi.cg.am</span><br><span class="line"> * <span class="doctag">@param</span> array $items</span><br><span class="line"> * <span class="doctag">@return</span> array</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genTree9</span><span class="params">(Array <span class="variable">$items</span>)</span> </span>&#123;</span><br><span class="line">    <span class="variable">$tree</span> = <span class="keyword">array</span>();    <span class="comment">//格式化好的树</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$items</span> <span class="keyword">as</span> <span class="variable">$item</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$items</span>[<span class="variable">$item</span>[<span class="string">'pid'</span>]]))</span><br><span class="line">            <span class="variable">$items</span>[<span class="variable">$item</span>[<span class="string">'pid'</span>]][<span class="string">'son'</span>][] = &amp;<span class="variable">$items</span>[<span class="variable">$item</span>[<span class="string">'id'</span>]];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="variable">$tree</span>[] = &amp;<span class="variable">$items</span>[<span class="variable">$item</span>[<span class="string">'id'</span>]];</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$tree</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$items</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">1</span>, <span class="string">'pid'</span> =&gt; <span class="number">0</span>, <span class="string">'name'</span> =&gt; <span class="string">'江西省'</span>),</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">2</span>, <span class="string">'pid'</span> =&gt; <span class="number">0</span>, <span class="string">'name'</span> =&gt; <span class="string">'黑龙江省'</span>),</span><br><span class="line">    <span class="number">3</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">3</span>, <span class="string">'pid'</span> =&gt; <span class="number">1</span>, <span class="string">'name'</span> =&gt; <span class="string">'南昌市'</span>),</span><br><span class="line">    <span class="number">4</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">4</span>, <span class="string">'pid'</span> =&gt; <span class="number">2</span>, <span class="string">'name'</span> =&gt; <span class="string">'哈尔滨市'</span>),</span><br><span class="line">    <span class="number">5</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">5</span>, <span class="string">'pid'</span> =&gt; <span class="number">2</span>, <span class="string">'name'</span> =&gt; <span class="string">'鸡西市'</span>),</span><br><span class="line">    <span class="number">6</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">6</span>, <span class="string">'pid'</span> =&gt; <span class="number">4</span>, <span class="string">'name'</span> =&gt; <span class="string">'香坊区'</span>),</span><br><span class="line">    <span class="number">7</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">7</span>, <span class="string">'pid'</span> =&gt; <span class="number">4</span>, <span class="string">'name'</span> =&gt; <span class="string">'南岗区'</span>),</span><br><span class="line">    <span class="number">8</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">8</span>, <span class="string">'pid'</span> =&gt; <span class="number">6</span>, <span class="string">'name'</span> =&gt; <span class="string">'和兴路'</span>),</span><br><span class="line">    <span class="number">9</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">9</span>, <span class="string">'pid'</span> =&gt; <span class="number">7</span>, <span class="string">'name'</span> =&gt; <span class="string">'西大直街'</span>),</span><br><span class="line">    <span class="number">10</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">10</span>, <span class="string">'pid'</span> =&gt; <span class="number">8</span>, <span class="string">'name'</span> =&gt; <span class="string">'东北林业大学'</span>),</span><br><span class="line">    <span class="number">11</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">11</span>, <span class="string">'pid'</span> =&gt; <span class="number">9</span>, <span class="string">'name'</span> =&gt; <span class="string">'哈尔滨工业大学'</span>),</span><br><span class="line">    <span class="number">12</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">12</span>, <span class="string">'pid'</span> =&gt; <span class="number">8</span>, <span class="string">'name'</span> =&gt; <span class="string">'哈尔滨师范大学'</span>),</span><br><span class="line">    <span class="number">13</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">13</span>, <span class="string">'pid'</span> =&gt; <span class="number">1</span>, <span class="string">'name'</span> =&gt; <span class="string">'赣州市'</span>),</span><br><span class="line">    <span class="number">14</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">14</span>, <span class="string">'pid'</span> =&gt; <span class="number">13</span>, <span class="string">'name'</span> =&gt; <span class="string">'赣县'</span>),</span><br><span class="line">    <span class="number">15</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">15</span>, <span class="string">'pid'</span> =&gt; <span class="number">13</span>, <span class="string">'name'</span> =&gt; <span class="string">'于都县'</span>),</span><br><span class="line">    <span class="number">16</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">16</span>, <span class="string">'pid'</span> =&gt; <span class="number">14</span>, <span class="string">'name'</span> =&gt; <span class="string">'茅店镇'</span>),</span><br><span class="line">    <span class="number">17</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">17</span>, <span class="string">'pid'</span> =&gt; <span class="number">14</span>, <span class="string">'name'</span> =&gt; <span class="string">'大田乡'</span>),</span><br><span class="line">    <span class="number">18</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">18</span>, <span class="string">'pid'</span> =&gt; <span class="number">16</span>, <span class="string">'name'</span> =&gt; <span class="string">'义源村'</span>),</span><br><span class="line">    <span class="number">19</span> =&gt; <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; <span class="number">19</span>, <span class="string">'pid'</span> =&gt; <span class="number">16</span>, <span class="string">'name'</span> =&gt; <span class="string">'上坝村'</span>),</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">header(<span class="string">"Content-Type: text/html; charset=utf-8"</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">print_r(genTree5(<span class="variable">$items</span>));</span><br><span class="line">print_r(genTree9(<span class="variable">$items</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/pre&gt;"</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>via:<a href="http://levi.cg.am/archives/2115" target="_blank" rel="external">http://levi.cg.am/archives/2115</a></p>
</blockquote>
<h3 id="解决中文用base64_decode解密的时候,出现乱码">解决中文用base64_decode解密的时候,出现乱码</h3><ul>
<li>利用PHP函数设置页面的头文件编码</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">"Content-Type:text/html;charset=utf-8"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>有一些中文字符,用GET形式传过来的时候,+号会被替换成空格.</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key</span> = base64_decode(str_replace(<span class="string">" "</span>,<span class="string">"+"</span>,<span class="variable">$_GET</span>[<span class="string">'key'</span>]));</span><br></pre></td></tr></table></figure>
<h3 id="缓冲区刷新">缓冲区刷新</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flush_buffers</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	ob_end_flush();</span><br><span class="line">	ob_flush();</span><br><span class="line">	flush();</span><br><span class="line">	ob_start(<span class="string">'ob_callback'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ob_callback</span><span class="params">(<span class="variable">$buffer</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$buffer</span> . str_repeat(<span class="string">' '</span>, max(<span class="number">0</span>, <span class="number">4097</span> - strlen(<span class="variable">$buffer</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="简单的页面缓存">简单的页面缓存</h3><p>如果你的项目不是基于 CMS 系统或框架，打造一个简单的缓存系统将会非常实在。下面的代码很简单，但是对小网站而言能切切实实解决问题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="comment">// define the path and name of cached file  </span></span><br><span class="line"><span class="variable">$cachefile</span> = <span class="string">'cached-files/'</span>.date(<span class="string">'M-d-Y'</span>).<span class="string">'.php'</span>;  </span><br><span class="line"><span class="comment">// define how long we want to keep the file in seconds. I set mine to 5 hours.  </span></span><br><span class="line"><span class="variable">$cachetime</span> = <span class="number">18000</span>;  </span><br><span class="line"><span class="comment">// Check if the cached file is still fresh. If it is, serve it up and exit.  </span></span><br><span class="line"><span class="keyword">if</span> (file_exists(<span class="variable">$cachefile</span>) &amp;&amp; time() - <span class="variable">$cachetime</span> &lt; filemtime(<span class="variable">$cachefile</span>)) &#123;  </span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$cachefile</span>);  </span><br><span class="line">    <span class="keyword">exit</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// if there is either no file OR the file to too old, render the page and capture the HTML.  </span></span><br><span class="line">ob_start();  </span><br><span class="line">  </span><br><span class="line">&lt;html&gt;  </span><br><span class="line">    output all your html here.  </span><br><span class="line">&lt;/html&gt;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// We're done! Save the cached content to a file  </span></span><br><span class="line"><span class="variable">$fp</span> = fopen(<span class="variable">$cachefile</span>, <span class="string">'w'</span>);  </span><br><span class="line">fwrite(<span class="variable">$fp</span>, ob_get_contents());  </span><br><span class="line">fclose(<span class="variable">$fp</span>);  </span><br><span class="line"><span class="comment">// finally send browser output  </span></span><br><span class="line">ob_end_flush();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>via: <a href="http://wesbos.com/simple-php-page-caching-technique/" target="_blank" rel="external">http://wesbos.com/simple-php-page-caching-technique/</a></p>
</blockquote>
<h3 id="在_PHP_中计算距离">在 PHP 中计算距离</h3><p>这是一个非常有用的距离计算函数，利用纬度和经度计算从 A 地点到 B地点的距离。该函数可以返回英里，公里，海里三种单位类型的距离。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">distance</span><span class="params">(<span class="variable">$lat1</span>, <span class="variable">$lon1</span>, <span class="variable">$lat2</span>, <span class="variable">$lon2</span>, <span class="variable">$unit</span>)</span> </span>&#123;   </span><br><span class="line">  <span class="variable">$theta</span> = <span class="variable">$lon1</span> - <span class="variable">$lon2</span>;  </span><br><span class="line">  <span class="variable">$dist</span> = sin(deg2rad(<span class="variable">$lat1</span>)) * sin(deg2rad(<span class="variable">$lat2</span>)) +  cos(deg2rad(<span class="variable">$lat1</span>)) * cos(deg2rad(<span class="variable">$lat2</span>)) * cos(deg2rad(<span class="variable">$theta</span>));  </span><br><span class="line">  <span class="variable">$dist</span> = acos(<span class="variable">$dist</span>);  </span><br><span class="line">  <span class="variable">$dist</span> = rad2deg(<span class="variable">$dist</span>);  </span><br><span class="line">  <span class="variable">$miles</span> = <span class="variable">$dist</span> * <span class="number">60</span> * <span class="number">1.1515</span>;  </span><br><span class="line">  <span class="variable">$unit</span> = strtoupper(<span class="variable">$unit</span>);  </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$unit</span> == <span class="string">"K"</span>) &#123;  </span><br><span class="line">    <span class="keyword">return</span> (<span class="variable">$miles</span> * <span class="number">1.609344</span>);  </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$unit</span> == <span class="string">"N"</span>) &#123;  </span><br><span class="line">      <span class="keyword">return</span> (<span class="variable">$miles</span> * <span class="number">0.8684</span>);  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$miles</span>;  </span><br><span class="line">      &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用方法：</span></span><br><span class="line"><span class="keyword">echo</span> distance(<span class="number">32.9697</span>, -<span class="number">96.80322</span>, <span class="number">29.46786</span>, -<span class="number">98.53506</span>, <span class="string">"k"</span>).<span class="string">" kilometers"</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="将秒数转换为时间(年、月、日、小时…)">将秒数转换为时间(年、月、日、小时…)</h3><p>这个有用的函数能将秒数表示的事件转换为年、月、日、小时等时间格式。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sec2Time</span><span class="params">(<span class="variable">$time</span>)</span></span>&#123;  </span><br><span class="line">  <span class="keyword">if</span>(is_numeric(<span class="variable">$time</span>))&#123;  </span><br><span class="line">    <span class="variable">$value</span> = <span class="keyword">array</span>(  </span><br><span class="line">      <span class="string">"years"</span> =&gt; <span class="number">0</span>, <span class="string">"days"</span> =&gt; <span class="number">0</span>, <span class="string">"hours"</span> =&gt; <span class="number">0</span>,  </span><br><span class="line">      <span class="string">"minutes"</span> =&gt; <span class="number">0</span>, <span class="string">"seconds"</span> =&gt; <span class="number">0</span>,  </span><br><span class="line">    );  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$time</span> &gt;= <span class="number">31556926</span>)&#123;  </span><br><span class="line">      <span class="variable">$value</span>[<span class="string">"years"</span>] = floor(<span class="variable">$time</span>/<span class="number">31556926</span>);  </span><br><span class="line">      <span class="variable">$time</span> = (<span class="variable">$time</span>%<span class="number">31556926</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$time</span> &gt;= <span class="number">86400</span>)&#123;  </span><br><span class="line">      <span class="variable">$value</span>[<span class="string">"days"</span>] = floor(<span class="variable">$time</span>/<span class="number">86400</span>);  </span><br><span class="line">      <span class="variable">$time</span> = (<span class="variable">$time</span>%<span class="number">86400</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$time</span> &gt;= <span class="number">3600</span>)&#123;  </span><br><span class="line">      <span class="variable">$value</span>[<span class="string">"hours"</span>] = floor(<span class="variable">$time</span>/<span class="number">3600</span>);  </span><br><span class="line">      <span class="variable">$time</span> = (<span class="variable">$time</span>%<span class="number">3600</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$time</span> &gt;= <span class="number">60</span>)&#123;  </span><br><span class="line">      <span class="variable">$value</span>[<span class="string">"minutes"</span>] = floor(<span class="variable">$time</span>/<span class="number">60</span>);  </span><br><span class="line">      <span class="variable">$time</span> = (<span class="variable">$time</span>%<span class="number">60</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="variable">$value</span>[<span class="string">"seconds"</span>] = floor(<span class="variable">$time</span>);  </span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">array</span>) <span class="variable">$value</span>;  </span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> (bool) <span class="keyword">FALSE</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="强制下载文件">强制下载文件</h3><p>一些诸如 mp3 类型的文件，通常会在客户端浏览器中直接被播放或使用。如果你希望它们强制被下载，也没问题。可以使用以下代码：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadFile</span><span class="params">(<span class="variable">$file</span>)</span></span>&#123;  </span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$file</span>;  </span><br><span class="line">        <span class="variable">$mime</span> = <span class="string">'application/force-download'</span>;  </span><br><span class="line">    header(<span class="string">'Pragma: public'</span>);     <span class="comment">// required  </span></span><br><span class="line">    header(<span class="string">'Expires: 0'</span>);        <span class="comment">// no cache  </span></span><br><span class="line">    header(<span class="string">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span>);  </span><br><span class="line">    header(<span class="string">'Cache-Control: private'</span>,<span class="keyword">false</span>);  </span><br><span class="line">    header(<span class="string">'Content-Type: '</span>.<span class="variable">$mime</span>);  </span><br><span class="line">    header(<span class="string">'Content-Disposition: attachment; filename="'</span>.basename(<span class="variable">$file_name</span>).<span class="string">'"'</span>);  </span><br><span class="line">    header(<span class="string">'Content-Transfer-Encoding: binary'</span>);  </span><br><span class="line">    header(<span class="string">'Connection: close'</span>);  </span><br><span class="line">    readfile(<span class="variable">$file_name</span>);        <span class="comment">// push it out  </span></span><br><span class="line">    <span class="keyword">exit</span>();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="PHP加密解密">PHP加密解密</h3><p>PHP加密和解密函数可以用来加密一些有用的字符串存放在数据库里，并且通过可逆解密字符串，该函数使用了base64和MD5加密和解密。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encryptDecrypt</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$string</span>, <span class="variable">$decrypt</span>)</span></span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$decrypt</span>)&#123; </span><br><span class="line">        <span class="variable">$decrypted</span> = rtrim(mcrypt_decrypt(MCRYPT_RIJNDAEL_256, md5(<span class="variable">$key</span>), base64_decode(<span class="variable">$string</span>), MCRYPT_MODE_CBC, md5(md5(<span class="variable">$key</span>))), <span class="string">"12"</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$decrypted</span>; </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="variable">$encrypted</span> = base64_encode(mcrypt_encrypt(MCRYPT_RIJNDAEL_256, md5(<span class="variable">$key</span>), <span class="variable">$string</span>, MCRYPT_MODE_CBC, md5(md5(<span class="variable">$key</span>)))); </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$encrypted</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="PHP获取文件大小并格式化">PHP获取文件大小并格式化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatSize</span><span class="params">(<span class="variable">$size</span>)</span> </span>&#123; </span><br><span class="line">    <span class="variable">$sizes</span> = <span class="keyword">array</span>(<span class="string">" Bytes"</span>, <span class="string">" KB"</span>, <span class="string">" MB"</span>, <span class="string">" GB"</span>, <span class="string">" TB"</span>, <span class="string">" PB"</span>, <span class="string">" EB"</span>, <span class="string">" ZB"</span>, <span class="string">" YB"</span>); </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$size</span> == <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">return</span>(<span class="string">'n/a'</span>);  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">      <span class="keyword">return</span> (round(<span class="variable">$size</span>/pow(<span class="number">1024</span>, (<span class="variable">$i</span> = floor(log(<span class="variable">$size</span>, <span class="number">1024</span>)))), <span class="number">2</span>) . <span class="variable">$sizes</span>[<span class="variable">$i</span>]);  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PHP获取当前页面URL">PHP获取当前页面URL</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curPageURL</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="variable">$pageURL</span> = <span class="string">'http'</span>; </span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_SERVER</span>[<span class="string">'HTTPS'</span>])) &#123;<span class="variable">$pageURL</span> .= <span class="string">"s"</span>;&#125; </span><br><span class="line">    <span class="variable">$pageURL</span> .= <span class="string">"://"</span>; </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">"SERVER_PORT"</span>] != <span class="string">"80"</span>) &#123; </span><br><span class="line">        <span class="variable">$pageURL</span> .= <span class="variable">$_SERVER</span>[<span class="string">"SERVER_NAME"</span>].<span class="string">":"</span>.<span class="variable">$_SERVER</span>[<span class="string">"SERVER_PORT"</span>].<span class="variable">$_SERVER</span>[<span class="string">"REQUEST_URI"</span>]; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="variable">$pageURL</span> .= <span class="variable">$_SERVER</span>[<span class="string">"SERVER_NAME"</span>].<span class="variable">$_SERVER</span>[<span class="string">"REQUEST_URI"</span>]; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$pageURL</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PHP强制下载文件">PHP强制下载文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">download</span><span class="params">(<span class="variable">$filename</span>)</span></span>&#123; </span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">isset</span>(<span class="variable">$filename</span>))&amp;&amp;(file_exists(<span class="variable">$filename</span>)))&#123; </span><br><span class="line">       header(<span class="string">"Content-length: "</span>.filesize(<span class="variable">$filename</span>)); </span><br><span class="line">       header(<span class="string">'Content-Type: application/octet-stream'</span>); </span><br><span class="line">       header(<span class="string">'Content-Disposition: attachment; filename="'</span> . <span class="variable">$filename</span> . <span class="string">'"'</span>); </span><br><span class="line">       readfile(<span class="string">"$filename"</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">       <span class="keyword">echo</span> <span class="string">"Looks like file does not exist!"</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PHP截取字符串长度">PHP截取字符串长度</h3><p>我们经常会遇到需要截取字符串(含中文汉字)长度的情况，比如标题显示不能超过多少字符，超出的长度用…表示，以下函数可以满足你的需求。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span><br><span class="line"> Utf-8、gb2312都支持的汉字截取函数 </span><br><span class="line"> cut_str(字符串, 截取长度, 开始长度, 编码); </span><br><span class="line"> 编码默认为 utf-8 </span><br><span class="line"> 开始长度默认为 0 </span><br><span class="line">*/</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cutStr</span><span class="params">(<span class="variable">$string</span>, <span class="variable">$sublen</span>, <span class="variable">$start</span> = <span class="number">0</span>, <span class="variable">$code</span> = <span class="string">'UTF-8'</span>)</span></span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$code</span> == <span class="string">'UTF-8'</span>)&#123; </span><br><span class="line">        <span class="variable">$pa</span> = <span class="string">"/[\x01-\x7f]|[\xc2-\xdf][\x80-\xbf]|\xe0[\xa0-\xbf][\x80-\xbf]|[\xe1-\xef][\x80-\xbf][\x80-\xbf]|\xf0[\x90-\xbf][\x80-\xbf][\x80-\xbf]|[\xf1-\xf7][\x80-\xbf][\x80-\xbf][\x80-\xbf]/"</span>; </span><br><span class="line">        preg_match_all(<span class="variable">$pa</span>, <span class="variable">$string</span>, <span class="variable">$t_string</span>); </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(count(<span class="variable">$t_string</span>[<span class="number">0</span>]) - <span class="variable">$start</span> &gt; <span class="variable">$sublen</span>) <span class="keyword">return</span> join(<span class="string">''</span>, array_slice(<span class="variable">$t_string</span>[<span class="number">0</span>], <span class="variable">$start</span>, <span class="variable">$sublen</span>)).<span class="string">"..."</span>; </span><br><span class="line">        <span class="keyword">return</span> join(<span class="string">''</span>, array_slice(<span class="variable">$t_string</span>[<span class="number">0</span>], <span class="variable">$start</span>, <span class="variable">$sublen</span>)); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$start</span>*<span class="number">2</span>; </span><br><span class="line">        <span class="variable">$sublen</span> = <span class="variable">$sublen</span>*<span class="number">2</span>; </span><br><span class="line">        <span class="variable">$strlen</span> = strlen(<span class="variable">$string</span>); </span><br><span class="line">        <span class="variable">$tmpstr</span> = <span class="string">''</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="variable">$strlen</span>; <span class="variable">$i</span>++)&#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$i</span>&gt;=<span class="variable">$start</span> &amp;&amp; <span class="variable">$i</span>&lt;(<span class="variable">$start</span>+<span class="variable">$sublen</span>))&#123; </span><br><span class="line">                <span class="keyword">if</span>(ord(substr(<span class="variable">$string</span>, <span class="variable">$i</span>, <span class="number">1</span>))&gt;<span class="number">129</span>)&#123; </span><br><span class="line">                    <span class="variable">$tmpstr</span>.= substr(<span class="variable">$string</span>, <span class="variable">$i</span>, <span class="number">2</span>); </span><br><span class="line">                &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">                    <span class="variable">$tmpstr</span>.= substr(<span class="variable">$string</span>, <span class="variable">$i</span>, <span class="number">1</span>); </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">if</span>(ord(substr(<span class="variable">$string</span>, <span class="variable">$i</span>, <span class="number">1</span>))&gt;<span class="number">129</span>) <span class="variable">$i</span>++; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$tmpstr</span>)&lt;<span class="variable">$strlen</span> ) <span class="variable">$tmpstr</span>.= <span class="string">"..."</span>; </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$tmpstr</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PHP获取客户端真实IP">PHP获取客户端真实IP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取用户真实IP </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">"HTTP_CLIENT_IP"</span>) &amp;&amp; strcasecmp(getenv(<span class="string">"HTTP_CLIENT_IP"</span>), <span class="string">"unknown"</span>)) </span><br><span class="line">        <span class="variable">$ip</span> = getenv(<span class="string">"HTTP_CLIENT_IP"</span>); </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="keyword">if</span> (getenv(<span class="string">"HTTP_X_FORWARDED_FOR"</span>) &amp;&amp; strcasecmp(getenv(<span class="string">"HTTP_X_FORWARDED_FOR"</span>), <span class="string">"unknown"</span>)) </span><br><span class="line">            <span class="variable">$ip</span> = getenv(<span class="string">"HTTP_X_FORWARDED_FOR"</span>); </span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">if</span> (getenv(<span class="string">"REMOTE_ADDR"</span>) &amp;&amp; strcasecmp(getenv(<span class="string">"REMOTE_ADDR"</span>), <span class="string">"unknown"</span>)) </span><br><span class="line">                <span class="variable">$ip</span> = getenv(<span class="string">"REMOTE_ADDR"</span>); </span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>]) &amp;&amp; <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>] &amp;&amp; strcasecmp(<span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>], <span class="string">"unknown"</span>)) </span><br><span class="line">                    <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>]; </span><br><span class="line">                <span class="keyword">else</span> </span><br><span class="line">                    <span class="variable">$ip</span> = <span class="string">"unknown"</span>; </span><br><span class="line">    <span class="keyword">return</span> (<span class="variable">$ip</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PHP防止SQL注入">PHP防止SQL注入</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">injCheck</span><span class="params">(<span class="variable">$sql_str</span>)</span> </span>&#123;  </span><br><span class="line">    <span class="variable">$check</span> = preg_match(<span class="string">'/select|insert|update|delete|\'|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile/'</span>, <span class="variable">$sql_str</span>); </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$check</span>) &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'非法字符！！'</span>; </span><br><span class="line">        <span class="keyword">exit</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$sql_str</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PHP页面提示与跳转">PHP页面提示与跳转</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">message</span><span class="params">(<span class="variable">$msgTitle</span>,<span class="variable">$message</span>,<span class="variable">$jumpUrl</span>)</span></span>&#123; </span><br><span class="line">    <span class="variable">$str</span> = <span class="string">'&lt;!DOCTYPE HTML&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;html&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;head&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;meta charset="utf-8"&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;title&gt;页面提示&lt;/title&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;style type="text/css"&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'*&#123;margin:0; padding:0&#125;a&#123;color:#369; text-decoration:none;&#125;a:hover&#123;text-decoration:underline&#125;body&#123;height:100%; font:12px/18px Tahoma, Arial,  sans-serif; color:#424242; background:#fff&#125;.message&#123;width:450px; height:120px; margin:16% auto; border:1px solid #99b1c4; background:#ecf7fb&#125;.message h3&#123;height:28px; line-height:28px; background:#2c91c6; text-align:center; color:#fff; font-size:14px&#125;.msg_txt&#123;padding:10px; margin-top:8px&#125;.msg_txt h4&#123;line-height:26px; font-size:14px&#125;.msg_txt h4.red&#123;color:#f30&#125;.msg_txt p&#123;line-height:22px&#125;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;/style&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;/head&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;body&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;div class="message"&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;h3&gt;'</span>.<span class="variable">$msgTitle</span>.<span class="string">'&lt;/h3&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;div class="msg_txt"&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;h4 class="red"&gt;'</span>.<span class="variable">$message</span>.<span class="string">'&lt;/h4&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;p&gt;系统将在 &lt;span style="color:blue;font-weight:bold"&gt;3&lt;/span&gt; 秒后自动跳转,如果不想等待,直接点击 &lt;a href="&#123;$jumpUrl&#125;"&gt;这里&lt;/a&gt; 跳转&lt;/p&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">"&lt;script&gt;setTimeout('location.replace(\'"</span>.<span class="variable">$jumpUrl</span>.<span class="string">"\')',2000)&lt;/script&gt;"</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;/div&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;/div&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;/body&gt;'</span>; </span><br><span class="line">    <span class="variable">$str</span> .= <span class="string">'&lt;/html&gt;'</span>; </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PHP计算时长">PHP计算时长</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeTimeType</span><span class="params">(<span class="variable">$seconds</span>)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$seconds</span> &gt; <span class="number">3600</span>) &#123; </span><br><span class="line">        <span class="variable">$hours</span> = intval(<span class="variable">$seconds</span> / <span class="number">3600</span>); </span><br><span class="line">        <span class="variable">$minutes</span> = <span class="variable">$seconds</span> % <span class="number">3600</span>; </span><br><span class="line">        <span class="variable">$time</span> = <span class="variable">$hours</span> . <span class="string">":"</span> . gmstrftime(<span class="string">'%M:%S'</span>, <span class="variable">$minutes</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="variable">$time</span> = gmstrftime(<span class="string">'%H:%M:%S'</span>, <span class="variable">$seconds</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$time</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PHP打印数组">PHP打印数组</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cf_dd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	array_map(<span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$x</span>)</span> </span>&#123; var_dump(<span class="variable">$x</span>); &#125;, func_get_args()); <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="遍历删除目录和目录下所有文件">遍历删除目录和目录下所有文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cf_del_dir</span><span class="params">(<span class="variable">$dir</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!is_dir(<span class="variable">$dir</span>))&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$handle</span> = opendir(<span class="variable">$dir</span>);</span><br><span class="line">	<span class="keyword">while</span> ((<span class="variable">$file</span> = readdir(<span class="variable">$handle</span>)) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$file</span> != <span class="string">"."</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">".."</span>)&#123;</span><br><span class="line">			is_dir(<span class="string">"$dir/$file"</span>)?	cf_del_dir(<span class="string">"$dir/$file"</span>):@unlink(<span class="string">"$dir/$file"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (readdir(<span class="variable">$handle</span>) == <span class="keyword">false</span>)&#123;</span><br><span class="line">		closedir(<span class="variable">$handle</span>);</span><br><span class="line">		@rmdir(<span class="variable">$dir</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">```	</span><br><span class="line"><span class="comment">### 纠正不完整HTML(by [overtrue](https://github.com/overtrue))</span></span><br><span class="line">``` php</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">force_balance_tags</span><span class="params">( <span class="variable">$text</span> )</span> </span>&#123;</span><br><span class="line">    <span class="variable">$tagstack</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="variable">$stacksize</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$tagqueue</span> = <span class="string">''</span>;</span><br><span class="line">    <span class="variable">$newtext</span> = <span class="string">''</span>;</span><br><span class="line">    <span class="comment">// Known single-entity/self-closing tags</span></span><br><span class="line">    <span class="variable">$single_tags</span> = <span class="keyword">array</span>( <span class="string">'area'</span>, <span class="string">'base'</span>, <span class="string">'basefont'</span>, <span class="string">'br'</span>, <span class="string">'col'</span>, <span class="string">'command'</span>, <span class="string">'embed'</span>, <span class="string">'frame'</span>, <span class="string">'hr'</span>, <span class="string">'img'</span>, <span class="string">'input'</span>, <span class="string">'isindex'</span>, <span class="string">'link'</span>, <span class="string">'meta'</span>, <span class="string">'param'</span>, <span class="string">'source'</span> );</span><br><span class="line">    <span class="comment">// Tags that can be immediately nested within themselves</span></span><br><span class="line">    <span class="variable">$nestable_tags</span> = <span class="keyword">array</span>( <span class="string">'blockquote'</span>, <span class="string">'div'</span>, <span class="string">'object'</span>, <span class="string">'q'</span>, <span class="string">'span'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// WP <span class="doctag"><span class="keyword">bug</span></span> fix for comments - in case you REALLY meant to type '&lt; !--'</span></span><br><span class="line">    <span class="variable">$text</span> = str_replace(<span class="string">'&lt; !--'</span>, <span class="string">'&lt;    !--'</span>, <span class="variable">$text</span>);</span><br><span class="line">    <span class="comment">// WP <span class="doctag"><span class="keyword">bug</span></span> fix for LOVE &lt;3 (and other situations with '&lt;' before a number)</span></span><br><span class="line">    <span class="variable">$text</span> = preg_replace(<span class="string">'#&lt;([0-9]&#123;1&#125;)#'</span>, <span class="string">'&amp;lt;$1'</span>, <span class="variable">$text</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ( preg_match(<span class="string">"/&lt;(\/?[\w:]*)\s*([^&gt;]*)&gt;/"</span>, <span class="variable">$text</span>, <span class="variable">$regex</span>) ) &#123;</span><br><span class="line">        <span class="variable">$newtext</span> .= <span class="variable">$tagqueue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$i</span> = strpos(<span class="variable">$text</span>, <span class="variable">$regex</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="variable">$l</span> = strlen(<span class="variable">$regex</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// clear the shifter</span></span><br><span class="line">        <span class="variable">$tagqueue</span> = <span class="string">''</span>;</span><br><span class="line">        <span class="comment">// Pop or Push</span></span><br><span class="line">        <span class="keyword">if</span> ( <span class="keyword">isset</span>(<span class="variable">$regex</span>[<span class="number">1</span>][<span class="number">0</span>]) &amp;&amp; <span class="string">'/'</span> == <span class="variable">$regex</span>[<span class="number">1</span>][<span class="number">0</span>] ) &#123; <span class="comment">// End Tag</span></span><br><span class="line">            <span class="variable">$tag</span> = strtolower(substr(<span class="variable">$regex</span>[<span class="number">1</span>],<span class="number">1</span>));</span><br><span class="line">            <span class="comment">// if too many closing tags</span></span><br><span class="line">            <span class="keyword">if</span>( <span class="variable">$stacksize</span> &lt;= <span class="number">0</span> ) &#123;</span><br><span class="line">                <span class="variable">$tag</span> = <span class="string">''</span>;</span><br><span class="line">                <span class="comment">// or close to be safe $tag = '/' . $tag;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// if stacktop value = tag close value then pop</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">$tagstack</span>[<span class="variable">$stacksize</span> - <span class="number">1</span>] == <span class="variable">$tag</span> ) &#123; <span class="comment">// found closing tag</span></span><br><span class="line">                <span class="variable">$tag</span> = <span class="string">'&lt;/'</span> . <span class="variable">$tag</span> . <span class="string">'&gt;'</span>; <span class="comment">// Close Tag</span></span><br><span class="line">                <span class="comment">// Pop</span></span><br><span class="line">                array_pop( <span class="variable">$tagstack</span> );</span><br><span class="line">                <span class="variable">$stacksize</span>--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// closing tag not at top, search for it</span></span><br><span class="line">                <span class="keyword">for</span> ( <span class="variable">$j</span> = <span class="variable">$stacksize</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>-- ) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ( <span class="variable">$tagstack</span>[<span class="variable">$j</span>] == <span class="variable">$tag</span> ) &#123;</span><br><span class="line">                    <span class="comment">// add tag to tagqueue</span></span><br><span class="line">                        <span class="keyword">for</span> ( <span class="variable">$k</span> = <span class="variable">$stacksize</span>-<span class="number">1</span>; <span class="variable">$k</span> &gt;= <span class="variable">$j</span>; <span class="variable">$k</span>--) &#123;</span><br><span class="line">                            <span class="variable">$tagqueue</span> .= <span class="string">'&lt;/'</span> . array_pop( <span class="variable">$tagstack</span> ) . <span class="string">'&gt;'</span>;</span><br><span class="line">                            <span class="variable">$stacksize</span>--;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$tag</span> = <span class="string">''</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// Begin Tag</span></span><br><span class="line">            <span class="variable">$tag</span> = strtolower(<span class="variable">$regex</span>[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Tag Cleaning</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// If it's an empty tag "&lt; &gt;", do nothing</span></span><br><span class="line">            <span class="keyword">if</span> ( <span class="string">''</span> == <span class="variable">$tag</span> ) &#123;</span><br><span class="line">                <span class="comment">// do nothing</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ElseIf it presents itself as a self-closing tag...</span></span><br><span class="line">            <span class="keyword">elseif</span> ( substr( <span class="variable">$regex</span>[<span class="number">2</span>], -<span class="number">1</span> ) == <span class="string">'/'</span> ) &#123;</span><br><span class="line">                <span class="comment">// ...but it isn't a known single-entity self-closing tag, then don't let it be treated as such and</span></span><br><span class="line">                <span class="comment">// immediately close it with a closing tag (the tag will encapsulate no text as a result)</span></span><br><span class="line">                <span class="keyword">if</span> ( ! in_array( <span class="variable">$tag</span>, <span class="variable">$single_tags</span> ) )</span><br><span class="line">                    <span class="variable">$regex</span>[<span class="number">2</span>] = trim( substr( <span class="variable">$regex</span>[<span class="number">2</span>], <span class="number">0</span>, -<span class="number">1</span> ) ) . <span class="string">"&gt;&lt;/$tag"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ElseIf it's a known single-entity tag but it doesn't close itself, do so</span></span><br><span class="line">            <span class="keyword">elseif</span> ( in_array(<span class="variable">$tag</span>, <span class="variable">$single_tags</span>) ) &#123;</span><br><span class="line">                <span class="variable">$regex</span>[<span class="number">2</span>] .= <span class="string">'/'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Else it's not a single-entity tag</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// If the top of the stack is the same as the tag we want to push, close previous tag</span></span><br><span class="line">                <span class="keyword">if</span> ( <span class="variable">$stacksize</span> &gt; <span class="number">0</span> &amp;&amp; !in_array(<span class="variable">$tag</span>, <span class="variable">$nestable_tags</span>) &amp;&amp; <span class="variable">$tagstack</span>[<span class="variable">$stacksize</span> - <span class="number">1</span>] == <span class="variable">$tag</span> ) &#123;</span><br><span class="line">                    <span class="variable">$tagqueue</span> = <span class="string">'&lt;/'</span> . array_pop( <span class="variable">$tagstack</span> ) . <span class="string">'&gt;'</span>;</span><br><span class="line">                    <span class="variable">$stacksize</span>--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$stacksize</span> = array_push( <span class="variable">$tagstack</span>, <span class="variable">$tag</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Attributes</span></span><br><span class="line">            <span class="variable">$attributes</span> = <span class="variable">$regex</span>[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">if</span>( ! <span class="keyword">empty</span>( <span class="variable">$attributes</span> ) &amp;&amp; <span class="variable">$attributes</span>[<span class="number">0</span>] != <span class="string">'&gt;'</span> )</span><br><span class="line">                <span class="variable">$attributes</span> = <span class="string">' '</span> . <span class="variable">$attributes</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$tag</span> = <span class="string">'&lt;'</span> . <span class="variable">$tag</span> . <span class="variable">$attributes</span> . <span class="string">'&gt;'</span>;</span><br><span class="line">            <span class="comment">//If already queuing a close tag, then put this tag on, too</span></span><br><span class="line">            <span class="keyword">if</span> ( !<span class="keyword">empty</span>(<span class="variable">$tagqueue</span>) ) &#123;</span><br><span class="line">                <span class="variable">$tagqueue</span> .= <span class="variable">$tag</span>;</span><br><span class="line">                <span class="variable">$tag</span> = <span class="string">''</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$newtext</span> .= substr(<span class="variable">$text</span>, <span class="number">0</span>, <span class="variable">$i</span>) . <span class="variable">$tag</span>;</span><br><span class="line">        <span class="variable">$text</span> = substr(<span class="variable">$text</span>, <span class="variable">$i</span> + <span class="variable">$l</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Clear Tag Queue</span></span><br><span class="line">    <span class="variable">$newtext</span> .= <span class="variable">$tagqueue</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add Remaining text</span></span><br><span class="line">    <span class="variable">$newtext</span> .= <span class="variable">$text</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Empty Stack</span></span><br><span class="line">    <span class="keyword">while</span>( <span class="variable">$x</span> = array_pop(<span class="variable">$tagstack</span>) )</span><br><span class="line">        <span class="variable">$newtext</span> .= <span class="string">'&lt;/'</span> . <span class="variable">$x</span> . <span class="string">'&gt;'</span>; <span class="comment">// Add remaining tags to close</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// WP fix for the <span class="doctag"><span class="keyword">bug</span></span> with HTML comments</span></span><br><span class="line">    <span class="variable">$newtext</span> = str_replace(<span class="string">"&lt; !--"</span>,<span class="string">"&lt;!--"</span>,<span class="variable">$newtext</span>);</span><br><span class="line">    <span class="variable">$newtext</span> = str_replace(<span class="string">"&lt;    !--"</span>,<span class="string">"&lt; !--"</span>,<span class="variable">$newtext</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$newtext</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//demo</span></span><br><span class="line"><span class="keyword">echo</span> force_balance_tags(<span class="string">'&lt;p&gt;&lt;a&gt;overtrue&lt;p&gt;'</span>);</span><br></pre></td></tr></table></figure>
      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/php/"> #php </a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/07/10/Markdown简明语法教程/">Markdown简明语法教程</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/07/10/MySQL笔记/">MySQL笔记</a>
            
          </div>
        </div>
      

      
      
    </div>
  </div>



    <div class="post-spread">
      
    </div>

    
      <div class="comments" id="comments">
        
          <div class="ds-thread" data-thread-key="2015/07/10/PHP技巧汇总/"
               data-title="PHP技巧汇总" data-url="http://misael.cn/2015/07/10/PHP技巧汇总/">
          </div>
        
      </div>
    
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/uploads/images/avatar_white.png" alt="Misael Yau" />
          <p class="site-author-name">Misael Yau</p>
        </div>
        <p class="site-description motion-element">Misael's Blog</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">13</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">22</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </div>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/raomingchao" target="_blank">github</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://weibo.com/misael" target="_blank">weibo</a>
            </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>
        
      </div>

      
        <div class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#自动加载类"><span class="nav-number">1.</span> <span class="nav-text">自动加载类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证邮件地址"><span class="nav-number">2.</span> <span class="nav-text">验证邮件地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#净化_HTML_输入和输出"><span class="nav-number">3.</span> <span class="nav-text">净化 HTML 输入和输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检测一个值是否为_null_或_false"><span class="nav-number">4.</span> <span class="nav-text">检测一个值是否为 null 或 false</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成唯一订单号"><span class="nav-number">5.</span> <span class="nav-text">生成唯一订单号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5行vs9行_不用递归实现无限分类数据的树形格式化"><span class="nav-number">6.</span> <span class="nav-text">5行vs9行 不用递归实现无限分类数据的树形格式化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决中文用base64_decode解密的时候,出现乱码"><span class="nav-number">7.</span> <span class="nav-text">解决中文用base64_decode解密的时候,出现乱码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓冲区刷新"><span class="nav-number">8.</span> <span class="nav-text">缓冲区刷新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单的页面缓存"><span class="nav-number">9.</span> <span class="nav-text">简单的页面缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在_PHP_中计算距离"><span class="nav-number">10.</span> <span class="nav-text">在 PHP 中计算距离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将秒数转换为时间(年、月、日、小时…)"><span class="nav-number">11.</span> <span class="nav-text">将秒数转换为时间(年、月、日、小时…)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#强制下载文件"><span class="nav-number">12.</span> <span class="nav-text">强制下载文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP加密解密"><span class="nav-number">13.</span> <span class="nav-text">PHP加密解密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP获取文件大小并格式化"><span class="nav-number">14.</span> <span class="nav-text">PHP获取文件大小并格式化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP获取当前页面URL"><span class="nav-number">15.</span> <span class="nav-text">PHP获取当前页面URL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP强制下载文件"><span class="nav-number">16.</span> <span class="nav-text">PHP强制下载文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP截取字符串长度"><span class="nav-number">17.</span> <span class="nav-text">PHP截取字符串长度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP获取客户端真实IP"><span class="nav-number">18.</span> <span class="nav-text">PHP获取客户端真实IP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP防止SQL注入"><span class="nav-number">19.</span> <span class="nav-text">PHP防止SQL注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP页面提示与跳转"><span class="nav-number">20.</span> <span class="nav-text">PHP页面提示与跳转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP计算时长"><span class="nav-number">21.</span> <span class="nav-text">PHP计算时长</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP打印数组"><span class="nav-number">22.</span> <span class="nav-text">PHP打印数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遍历删除目录和目录下所有文件"><span class="nav-number">23.</span> <span class="nav-text">遍历删除目录和目录下所有文件</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </div>
      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Misael Yau</span>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.3"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.3"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.3" id="motion.global"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.3" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if (isDesktop() && CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    });
  </script>




  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"misael"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  


  
  

  
  <!-- lazyload -->
  <script type="text/javascript" src="/js/lazyload.js"></script>
      <script type="text/javascript">
        jQuery(function() {          
            jQuery("#posts img").lazyload({
              placeholder:"http://www.arao.me/loading.gif",  
                effect:"fadeIn"
              });
            });
    </script>   
</body>
</html>
